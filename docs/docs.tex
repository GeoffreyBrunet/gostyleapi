\documentclass[a4paper, 11pt]{report}

\usepackage[french]{babel}
\usepackage[utf8]{inputenc}
\usepackage[OT1]{fontenc}
\usepackage{graphicx}
\usepackage{pdftricks}
\usepackage{svg}

\begin{document}

\title{MSPR: Développement d’une application informatique dans le respect du cahier des charges Client}
\author{Brunet Geoffrey, Salamolard Baptiste}
\graphicspath{ {images/} }
\maketitle

\tableofcontents

\chapter{Introduction}
Ce projet est une application qui permet de scanner des coupons de réduction, sous forme de code QR.
\newline
Le projet Github pour l'application Android se trouve à cette adresse:
\newline
https://github.com/Ressio1/MSPR
\newline
Le projet Github pour l'API se trouve à cette adresse:
\newline
https://github.com/GeoffreyBrunet/gostyleapi
\newline
\newline
Elle se divise donc en trois parties distinctes:
\newline
- l'application android, chargée d'afficher une liste de produits, et de scanner un qrcode pour afficher une promotion sur un produit.
\newline
- une API (Application Programming Interface, permet de communiquer avec d'autres produits et services sans connaître les détails de leur mise en œuvre) qui fait le lien entre l'application et la base de données.
\newline
- la base de données, pour stocker des informations sur le long terme.
\newline
\newline
\includegraphics[scale=0.65]{./images/Introduction/schema-app.PNG}
\chapter{Application mobile}
\section{Java sur Android Studio}
À la vue du cahier des charges nous nous sommes tournés vers une application Android n’ayant pas personnellement de Mac ou même d’outil Apple le développement d’une application IOS aurait été compliqués et nous aurait retardés.
\newline
\newline
De plus le développement sur Android nous as permis d'utiliser les compétences apprises lors du cours "Introduction au developpement Android", il aurait donc été dommage de faire cette application sur IOS.
\newline
Après avoir décidé que cette application serait sur Android il fallait ce décider sur le choix du langage, a ce stade nous hésitions entre deux, du Java et du Kotlin au final nous utiliserons le Java afin de réaliser l’application car nous avions eu auparavant différents cours de Java et des bases plus solides sur ce langage.
\newline
\newline
Nous avons essayé au départ le Kotlin mais les tutos sur Internet étant plutôt orienté Java et la non-connaissance de ce langage à fini par nous pousser à faire du Java.
\newline
Après avoir travaillé un moment sur le programme en Java j'ai confirmé le choix de passer sur du Java afin d’avancer plus aisément et d'avoir accès à plus d'aide aussi bien sur Internet qu’au sein du corps enseignant.
\section{Fonctionnement de l'application}
Pour commencer l’application se lance sur une page ou il est demandé de renseigner une adresse électronique, si cette adresse est déjà présente sur la Base de données alors un message d’erreur apparait.
\newline
\newline
Après avoir remplis le champ de l’adresse électronique on appui sur le bouton en dessous afin d’envoyer ce mail sur la BDD, c’est alors qu’apparait un Pop-up qui nous informe que l’adresse mail seras conservé mais non utilisé à des fins commerciales tous cela dans le but de respecter le RGPD.
\newline
\newline
\includegraphics[scale=0.4]{./images/Application-mobile/oui1.png}
\newline
\newline
Ce Pop-up doit obligatoirement être accepté par l’utilisateur sinon il ne peut pas accéder à la suite de l’application, après avoir accepté le Pop-up on arrive sur une nouvelle page qui nous affiche la liste des produits présentes sur la BDD sous forme de liste.
\newline
\newline
Dans cette liste on retrouve évidemment le Nom de l’article en vente ainsi que son prix et une image montrant le produit en question, cette liste est dynamique et dépend de ce qui est présent dans la BDD.
\newline
\newline
\includegraphics[scale=0.4]{./images/Application-mobile/oui2.png}
\newline
\newline
A la suite de cette liste se trouve un bouton nommé « QRCode », a l’appui du bouton la caméra de téléphone se lance après une demande des droits d’utilisations de l’appareil photo. Par la suite tout qrcode qui apparaitra devant l’appareil photo est automatiquement détecté, après avoir détecté le qrcode l’appareil photo se ferme (retour sur la page précédente avec la liste) et la signification du qrcode est envoyé à la BDD si ce qrcode correspond bien à une réduction alors la BDD nous retourne l’article en question avec son pourcentage de réduction. Il reste à calculer la réduction en local puis on affiche l’article avec son nouveau prix dans la liste précédente.
\newline
\newline
\includegraphics[scale=0.4]{./images/Application-mobile/oui4.png}
\includegraphics[scale=0.4]{./images/Application-mobile/oui3.png}
\newline
\newline
Un clic sur un article de la liste affiche un Pop-up rapide en bas de l’écran qui nous informe que nous essayons d’acheter un article avec son nom et son prix afin d’éviter toutes erreurs de l’utilisateur.
\section{Description du code}
\includegraphics[scale=0.5]{./images/Application-mobile/codeand1.png}
\newline
Au lancement de la fonction on initialise une connexion afin de contacter la base de données. C’est par ailleurs ici que l’on va utiliser l’url mis en paramètre lors de l’appel de la fonction.
\newline
\newline
\includegraphics[scale=0.5]{./images/Application-mobile/codeand2.png}
\newline
Cette partie du code seras exécuté seulement si la requête n’échoue pas, on peut voir ici qu’on traduit ce que l’on reçoit afin de pouvoir l’exploiter la réponse de la BDD. Finalement on coupe et récupère seulement les parties intéressantes que l’on veut afficher ou utiliser comme les noms les prix etc… 
\newline
\newline
\includegraphics[scale=0.5]{./images/Application-mobile/codeand3.png}
\newline
\chapter{Backend}
\section{Spring Boot}
Le langage java a été choisis pour le backend car il permet une abstraction du hardware et de l'OS grâce à la JVM. Présent dans la plupard des entreprises dans le monde, nous avons l'avantage d'une grande communauté pour écrire notre API REST la plus professionnelle possible.
Il est utilisé avec Maven, un outil de gestion d'automatisation et de dépendances pour Java.
\newline
\newline
Dans le cas ou la requêtes rate alors on affiche simplement un message d’erreur afin d’informer l’utilisateur que la requête n’a pas aboutie. 
\includegraphics[scale=0.4]{./images/Backend/spring.png}
\newline
\newline
Le framework Spring Boot a été choisis car il permet d'écrire du code plus facilement lisible, maintenable et avec tout un panel d'outils à disposition.
Un de ces outils utilisé est Spring Data JPA, qui est un ORM (object-relational mapping, ou en français mapping objet-relationnel) inspiré d'un autre ORM déjà présent depuis plusieurs années dans l'écosystème java, Hibernate.
Un ORM permet de manipuler des bases de données sans avoir à écrire de requêtes SQL, ce que nous faisons avec Spring Data JAP pour l'API REST à notre base de données.
\section{Création de l'image Docker}
À partir du JAR produit lors du build de l'API, nous le rajoutons dans une image docker, pour pouvoir lancer notre API depuis n'importe quel serveur où Docker est disponible.
\section{Déployement sur ECS chez AWS}
L'API a été déployée sur ECS (Elastic Container Service), un service qui permet de déployer des conteneurs tout en ayant abstraction de la gestion de l'infrastructure sous-jacente.
La solution d'utiliser Elastic Beanstalk, un service permetant de déployer une application sans avoir à gérer la machine virtuelle qui l'héberge n'a pas été retenue, car celui-ci ne propose que l'utilisation d'un JRE devellopé par Amazon (Amazon Corretto).
\section{Fonctionnement de l'API REST}
Une API dite REST (Representational state transfer) est un type d'architecture logicielle pour créer des services web, selon des contraintes de développement et de fonctionnement.
En utilisant Spring Boot, le patrno MVC (Modèle-vue-contrôleur) était le choix le plus logique.
\newline
\includegraphics[scale=1]{./images/Backend/myspring.png}
\newline
Cette image est l'arborescence de notre projet. Notre API ne délivrant pas de pages web, nous n'avons pas de vues.
\newline
\newline
Les controlleurs sont les routes de notre API, avec une partie de la logique de notre code.
\newline
\newline
Le dossier "model" contient les modèles utilisés par notre API, avec des annonations permettant de les utiliser comme modèle de notre base de données, par le biais de Spring Data JPA.
\newline
\newline
Le dossier "repository" contient les interfaces pour faire communiquer notre API avec notre base de données, en utilisant les modèles pour le transfert et le stockage de données.
\section{Tests unitaires}
Les tests unitaires écrits servent à tester des composants de notre code. Ces composants sont les modèles et les controlleurs, et non les interfaces car celles-ci n'ayant pas de logique de code, et étant implicitement testées lors des tests des controleurs.
\newline
\newline
\includegraphics[scale=0.8]{./images/Backend/test-mail.png}
\newline
\newline
Le framework de tests utilisé pour la rédaction de ceux-ci est Junit 5, un des principaux frameworks de tests disponibles pour le langage Java. Les tests unitaires lancent une partie du programme et comparent le resultat obtenu par raport à un résultat attendu, spécifié par le développeur.
\section{Analyse de code}
\includegraphics[scale=0.6]{./images/Backend/sonarqube1.png}
\newline
\newline
L'analyse de notre code est effectué par Sonarqube, qui en plus d'analyser la qualité de notre code, est capable de nous donner la couverture de tests, avec l'aide d'un autre logiciel, nommé jacoco.
\section{Tests de charge}
Nous aurions pu utiliser Jmeter pour nos tests de charge, mais la facture de notre application étant calculée au nombre de requêtes, il est impossible pour nous actuellement d'effectuer ce test en production.
\chapter{SGBD}
\section{théorème CAP}
Avant de choisir SGBD (Système de gestion de base de données), il faut décider du type de SGBD pour l'application, en fonction des différents cas d'usage.
\newline
Le théorème CAP a été écris pour palier à ce choix. Celui-ci ce compose en trois critères différents, qui sont:
\newline
- la cohérence (ou consistency en anglais)
\newline
- la disponibilité (ou availability en anglais)
\newline
- la tolérance au partitionnement (ou partition tolerance en anglais)
\newline
\newline
\includegraphics[scale=0.32]{./images/SGBD/Visualization-of-CAP-theorem.png}
\newline
\section{PostgreSQL}
Le choix de PostgreSQL c'est fait pour plusieurs raisons.
La première est qu'il est multiplateforme et multiarchitecture, ce qui permet une lagre disponibilité.
La deuxième est qu'il est performant et fiable, certes au détriment de nouvelles fonctionnalités.
La troisième et denière est qu'il est gratuit, Open Source, et avec une communauté active, ce qui permet de trouver facilement des solutions si un problème se présente.
\newline
\newline
PostgreSQL a une documentation bien fournie, qui permet un apprentissage plutôt simple.
Pour la création des tables et des données, nous avons utilisé une interface web elle aussi Open Source, appelée "PGAdmin 4".
\section{Tables et données dans la base de données}
Nous avons créé la base de données "shop" qui contiens 3 tables différentes: "emails", "product" et "promotions".
\newline
\newline
\includegraphics[scale=1.2]{./images/SGBD/mcd.png}
\newline
\newline
La table "emails" stocke les adresses mail des utilisateurs.
\newline
La table "product" stocke les produits en vente, avec des informations comme le prix, l'image, le nom du produit.
\newline
La table "promotions" stocke les qrcodes qui appliqueront les promotions, en lien avec les produits par le biais d'une clef étrangère, référencée au "product id" dans la table "product".
\newline  
\section{Déployement sur RDS chez AWS}
AWS propose RDS (Relational Database Service), un service de SGBD dans le cloud et sans gestion de serveur.
\newline  
Proposant PostgreSQL, cette solution a été retenue car nous n'avons pas à gérer le serveur hébergeant notre SGBD.

\end{document}
